!function(a){a.fn.imageProjection=function(b,c){function d(a,b){var c=a-n.width()/2,d=b-n.height()/2;c=Math.max(c,0),d=Math.max(d,0),c=Math.min(c,l.width()-n.outerWidth()),d=Math.min(d,l.height()-n.outerHeight()),n.css({left:c+"px",top:d+"px"}),o.css("background-position",-1*c*i+"px "+-1*d*j+"px")}var e=new Image;e.src=b.attr("src");var f=new Image,g=e.width,h=e.height,i=1,j=1,k=a(window),l=this,m=this.offset();l.parent().css({position:"relative"});var n=a("<div id='ip-viewfinder'></div>"),o=a("<div id='ip-projection'></div>");return f.onload=function(){i=f.width/e.width,j=f.height/e.height,n.width(g*(1/i)),n.height(h*(1/j)),n.css({position:"absolute","z-index":3,display:"none"}),o.width(g),o.height(h),o.css({background:"url('"+f.src+"') no-repeat 0 0",display:"none",position:"absolute",left:l.width()+30,top:0,"z-index":3}),l.find("#viewfinder").remove(),l.parent().find("#projection").remove(),l.append(n),l.parent().append(o)},f.src=""==b.data("pimg")?b.attr("src"):b.data("pimg"),this.hover(function(a){n.fadeIn(500),o.fadeIn(500)},function(a){n.fadeOut(250),o.fadeOut(250)}),this.mousemove(function(a){var b=k.scrollTop(),c=k.scrollLeft();d(Math.floor(a.clientX-m.left+c),Math.floor(a.clientY-m.top+b))}),this}}(window.jQuery);