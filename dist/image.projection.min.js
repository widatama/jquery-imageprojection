!function(a){function b(b){"use strict";var c=this,d={},e={className:"ip-viewfinder",width:1,height:1,boundaries:{width:100,height:100}};d=a.extend(e,b),this.$el=a("<div/>",{"class":d.className}),this.$el.width(d.width),this.$el.height(d.height);var f=function(a){var b={};return b.left=a.left-c.$el.width()/2,b.top=a.top-c.$el.height()/2,b.left=Math.max(b.left,0),b.top=Math.max(b.top,0),b.left=Math.min(b.left,d.boundaries.width-c.$el.outerWidth()),b.top=Math.min(b.top,d.boundaries.height-c.$el.outerHeight()),b};this.setPosition=function(a){var b=f(a);c.$el.css({left:b.left+"px",top:b.top+"px"})},this.setSize=function(a){c.$el.width(d.width),c.$el.height(d.height)},this.show=function(a){c.$el.addClass("ip-viewfinder--shown")},this.hide=function(a){c.$el.removeClass("ip-viewfinder--shown")}}a.fn.imageProjection=function(c,d){"use strict";var e=new Image;e.src=c.attr("src");var f=new Image,g=e.width,h=e.height,i=1,j=1,k=a(window),l=this,m=this.offset();l.parent().css({position:"relative"});var n,o=a("<div id='ip-projection'></div>");return f.onload=function(){i=f.width/e.width,j=f.height/e.height,n=new b({width:g/i,height:h/j,boundaries:{width:l.width(),height:l.height()}}),o.width(g),o.height(h),o.css({background:"url('"+f.src+"') no-repeat 0 0",display:"none",position:"absolute",left:l.width()+30,top:0,"z-index":3}),l.parent().find("#ip-projection").remove(),l.append(n.$el),l.parent().append(o)},f.src=""===c.data("pimg")?c.attr("src"):c.data("pimg"),this.hover(function(a){n.show(500),o.fadeIn(500)},function(a){n.hide(250),o.fadeOut(250)}),this.mousemove(function(a){var b={};b.left=Math.floor(a.clientX-m.left+k.scrollLeft()),b.top=Math.floor(a.clientY-m.top+k.scrollTop()),n.setPosition(b)}),this}}(window.jQuery);