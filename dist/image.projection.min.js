!function(a){function b(b){"use strict";var c=this,d={},e={className:"ip-viewfinder",width:1,height:1,boundaries:{width:100,height:100}};d=a.extend(e,b),this.$el=a("<div/>",{"class":d.className}),this.$el.width(d.width),this.$el.height(d.height),this.position={};var f=function(a){var b={};return b.left=a.left-c.$el.width()/2,b.top=a.top-c.$el.height()/2,b.left=Math.max(b.left,0),b.top=Math.max(b.top,0),b.left=Math.min(b.left,d.boundaries.width-c.$el.outerWidth()),b.top=Math.min(b.top,d.boundaries.height-c.$el.outerHeight()),b};this.setPosition=function(a){c.position=f(a),c.$el.css({left:c.position.left+"px",top:c.position.top+"px"})},this.setSize=function(a){c.$el.width(d.width),c.$el.height(d.height)},this.show=function(){c.$el.addClass(d.className+"--shown")},this.hide=function(){c.$el.removeClass(d.className+"--shown")},this.destroy=function(){c.$el.remove()}}a.fn.imageProjection=function(e){"use strict";var f=this,g={},h={className:"ip-container"};g=a.extend(h,e),this.addClass(g.className);var i,j=this.find(">img"),k=1,l=1,m=a(window),n=new d({$image:j}),o=new c({imageUrl:""===j.data("pimg")?j.attr("src"):j.data("pimg"),width:n.width,height:n.height,position:{left:n.width+30}});return o.$el.on("ip.projection.imageLoaded",function(){k=o.image.width/n.width,l=o.image.height/n.height,i=new b({width:n.width/k,height:n.height/l,boundaries:{width:n.width,height:n.height}}),n.$el.append(i.$el),f.prepend(n.$el),f.append(o.$el)}),n.$el.hover(function(a){i.show(),o.show()},function(a){i.hide(),o.hide()}),n.$el.mousemove(function(a){var b={};b.left=Math.floor(a.clientX-n.getOffset().left+m.scrollLeft()),b.top=Math.floor(a.clientY-n.getOffset().top+m.scrollTop()),i.setPosition(b);var c={};c.left=-1*i.position.left*k,c.top=-1*i.position.top*l,o.setImagePosition(c)}),this};var c=function(b){"use strict";var c=this,d={},e={className:"ip-projection",imageUrl:"",width:1,height:1,position:{left:0,top:0}};d=a.extend(e,b),this.$el=a("<div/>",{"class":d.className}),this.image=new Image,this.image.src=d.imageUrl,this.image.onload=function(){c.$el.trigger("ip.projection.imageLoaded"),c.$el.css({"background-image":"url('"+c.image.src+"')","background-repeat":"no-repeat",left:d.position.left})},this.setImagePosition=function(a){c.$el.css({"background-position":a.left+"px "+a.top+"px"})},this.show=function(){c.$el.addClass(d.className+"--shown"),c.$el.css({width:d.width,height:d.height})},this.hide=function(){c.$el.removeClass(d.className+"--shown"),c.$el.css({width:0,height:0})},this.destroy=function(){c.$el.remove()}},d=function(b){"use strict";var c=this,d={},e={className:"ip-surface"};d=a.extend(e,b),this.image=new Image,this.image.src=d.$image.attr("src"),this.width=this.image.width,this.height=this.image.height,this.$el=a("<div/>",{"class":d.className,width:c.width,height:c.height}),this.getOffset=function(){return c.$el.offset()}}}(window.jQuery);