!function(a){function b(b){"use strict";var c=this,d={},e={className:"ip-viewfinder",width:1,height:1,boundaries:{width:100,height:100}};d=a.extend(e,b),this.$el=a("<div/>",{"class":d.className}),this.$el.width(d.width),this.$el.height(d.height),this.position={};var f=function(a){var b={};return b.left=a.left-c.$el.width()/2,b.top=a.top-c.$el.height()/2,b.left=Math.max(b.left,0),b.top=Math.max(b.top,0),b.left=Math.min(b.left,d.boundaries.width-c.$el.outerWidth()),b.top=Math.min(b.top,d.boundaries.height-c.$el.outerHeight()),b};this.setPosition=function(a){c.position=f(a),c.$el.css({left:c.position.left+"px",top:c.position.top+"px"})},this.setSize=function(a){c.$el.width(d.width),c.$el.height(d.height)},this.show=function(){c.$el.addClass(d.className+"--shown")},this.hide=function(){c.$el.removeClass(d.className+"--shown")},this.destroy=function(){c.$el.remove()}}a.fn.imageProjection=function(d,e){"use strict";var f=new Image;f.src=d.attr("src");var g=(new Image,f.width),h=f.height,i=1,j=1,k=a(window),l=this,m=this.offset();l.parent().css({position:"relative"});var n,o=new c({imageUrl:""===d.data("pimg")?d.attr("src"):d.data("pimg"),width:f.width,height:f.height,position:{left:l.width()+30}});return o.$el.on("ip.projection.imageLoaded",function(){i=o.image.width/f.width,j=o.image.height/f.height,n=new b({width:g/i,height:h/j,boundaries:{width:l.width(),height:l.height()}}),l.append(n.$el),l.parent().append(o.$el)}),this.hover(function(a){n.show(),o.show()},function(a){n.hide(),o.hide()}),this.mousemove(function(a){var b={};b.left=Math.floor(a.clientX-m.left+k.scrollLeft()),b.top=Math.floor(a.clientY-m.top+k.scrollTop()),n.setPosition(b);var c={};c.left=-1*n.position.left*i,c.top=-1*n.position.top*j,o.setImagePosition(c)}),this};var c=function(b){"use strict";var c=this,d={},e={className:"ip-projection",imageUrl:"",width:1,height:1,position:{left:0,top:0}};d=a.extend(e,b),this.$el=a("<div/>",{"class":d.className}),this.image=new Image,this.image.src=d.imageUrl,this.image.onload=function(){c.$el.trigger("ip.projection.imageLoaded"),c.$el.css({"background-image":"url('"+c.image.src+"')","background-repeat":"no-repeat",left:d.position.left})},this.setImagePosition=function(a){c.$el.css({"background-position":a.left+"px "+a.top+"px"})},this.show=function(){c.$el.addClass(d.className+"--shown"),c.$el.css({width:d.width,height:d.height})},this.hide=function(){c.$el.removeClass(d.className+"--shown"),c.$el.css({width:0,height:0})},this.destroy=function(){c.$el.remove()}}}(window.jQuery);