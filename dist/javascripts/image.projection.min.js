!function(a){if("undefined"!=typeof module&&module.exports)var a=require("jQuery"),b=require("./surface"),c=require("./viewfinder"),d=require("./projection");var e=function(e,f){"use strict";var g=this,h={},i={className:"ip-container"};h=a.extend(i,f),this.$el=e,e.addClass(h.className);var j=e.find("img.ip-source-image"),k=1,l=1,m=a(window),n=function(){k=g.projection.image.width/g.surface.width,l=g.projection.image.height/g.surface.height,g.viewfinder.setSize({width:g.surface.width/k,height:g.surface.height/l}),g.surface.$el.append(g.viewfinder.$el),g.$el.prepend(g.surface.$el),g.$el.append(g.projection.$el)},o=function(){g.viewfinder.show(),g.projection.show()},p=function(){g.viewfinder.hide(),g.projection.hide()},q=function(a){var b={};b.left=Math.floor(a.clientX-g.surface.getOffset().left+m.scrollLeft()),b.top=Math.floor(a.clientY-g.surface.getOffset().top+m.scrollTop()),g.viewfinder.setPosition(b);var c={};c.left=-1*g.viewfinder.position.left*k,c.top=-1*g.viewfinder.position.top*l,g.projection.setImagePosition(c)};this.surface=new b({$image:j}),this.viewfinder=new c({boundaries:{width:g.surface.width,height:g.surface.height}}),this.projection=new d({imageUrl:""===j.data("pimg")?j.attr("src"):j.data("pimg"),width:g.surface.width,height:g.surface.height,position:{left:g.surface.width+30}}),this.projection.$el.on("ip.projection.imageLoaded",n),this.surface.$el.hover(o,p),this.surface.$el.mousemove(q),this.destroy=function(){g.projection.destroy(),g.viewfinder.destroy(),g.surface.destroy()}};if("undefined"!=typeof module&&module.exports&&(module.exports=e),"undefined"!=typeof module&&module.exports)var a=require("jQuery");var b=function(b){"use strict";var c=this,d={},e={className:"ip-surface"};d=a.extend(e,b),this.image=new Image,this.image.src=d.$image.attr("src"),this.width=this.image.width,this.height=this.image.height,this.$el=a("<div/>",{"class":d.className,width:c.width,height:c.height}),this.getOffset=function(){return c.$el.offset()},this.destroy=function(){c.$el.remove(),c.$el=null}};if("undefined"!=typeof module&&module.exports&&(module.exports=b),"undefined"!=typeof module&&module.exports)var a=require("jQuery");var d=function(b){"use strict";var c=this,d={},e={className:"ip-projection",imageUrl:"",width:0,height:0,position:{left:0,top:0}};d=a.extend(e,b),this.$el=a("<div/>",{"class":d.className}),this.$el.css({left:d.position.left,top:d.position.top}),this.image=new Image,this.image.src=d.imageUrl,this.width=d.width,this.height=d.height,this.image.onload=function(){c.$el.trigger("ip.projection.imageLoaded"),c.$el.css({"background-image":"url('"+c.image.src+"')","background-repeat":"no-repeat"})},this.setImagePosition=function(a){c.$el.css({"background-position":a.left+"px "+a.top+"px"})},this.show=function(){c.$el.addClass(d.className+"--shown"),c.$el.css({width:d.width,height:d.height})},this.hide=function(){c.$el.removeClass(d.className+"--shown"),c.$el.css({width:0,height:0})},this.destroy=function(){c.$el.remove(),c.$el=null}};if("undefined"!=typeof module&&module.exports&&(module.exports=d),"undefined"!=typeof module&&module.exports)var a=require("jQuery");var c=function(b){"use strict";var c=this,d={},e={className:"ip-viewfinder",width:1,height:1,boundaries:{width:100,height:100}};d=a.extend(e,b),this.$el=a("<div/>",{"class":d.className}),this.$el.width(d.width),this.$el.height(d.height),this.position={};var f=function(a){var b={};return b.left=a.left-c.$el.width()/2,b.top=a.top-c.$el.height()/2,b.left=Math.max(b.left,0),b.top=Math.max(b.top,0),b.left=Math.min(b.left,d.boundaries.width-c.$el.outerWidth()),b.top=Math.min(b.top,d.boundaries.height-c.$el.outerHeight()),b};this.setPosition=function(a){c.position=f(a),c.$el.css({left:c.position.left+"px",top:c.position.top+"px"})},this.setSize=function(a){c.$el.width(a.width),c.$el.height(a.height)},this.show=function(){c.$el.addClass(d.className+"--shown")},this.hide=function(){c.$el.removeClass(d.className+"--shown")},this.destroy=function(){c.$el.remove(),c.$el=null}};"undefined"!=typeof module&&module.exports&&(module.exports=c);var f={init:function(b){"use strict";return this.each(function(b,c){var d=new e(a(c),{className:"ip-container"});a(c).data("imageProjection",d)})},destroy:function(){"use strict";return this.each(function(b,c){var d=a(c).data("imageProjection");d&&d.destroy()})}};a.fn.imageProjection=function(b,c){"use strict";return f[b]?f[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on this plugin"):f.init.apply(this,arguments)}}(window.jQuery);