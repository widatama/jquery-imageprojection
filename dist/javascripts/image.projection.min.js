!function(a){var b=function(f,g){"use strict";function h(){o=l.projection.image.width/l.surface.width,p=l.projection.image.height/l.surface.height,l.viewfinder.setSize({width:l.surface.width/o,height:l.surface.height/p}),l.surface.$el.append(l.viewfinder.$el),l.$el.prepend(l.surface.$el),l.$el.append(l.projection.$el)}function i(){l.viewfinder.show(),l.projection.show()}function j(){l.viewfinder.hide(),l.projection.hide()}function k(a){var b={};b.left=Math.floor(a.clientX-l.surface.getOffset().left+q.scrollLeft()),b.top=Math.floor(a.clientY-l.surface.getOffset().top+q.scrollTop()),l.viewfinder.setPosition(b);var c={};c.left=-1*l.viewfinder.position.left*o,c.top=-1*l.viewfinder.position.top*p,l.projection.setImagePosition(c)}var l=this,m={},n={},o=1,p=1,q=a(window),r={className:"ip-container"};m=a.extend(r,g),this.$el=f,f.addClass(m.className),n=f.find("img.ip-source-image"),this.surface=new c({$image:n}),this.viewfinder=new e({boundaries:{width:l.surface.width,height:l.surface.height}}),this.projection=new d({imageUrl:""===n.data("pimg")?n.attr("src"):n.data("pimg"),width:l.surface.width,height:l.surface.height,position:{left:l.surface.width+30}}),this.projection.$el.on("ip.projection.imageLoaded",h),this.surface.$el.hover(i,j),this.surface.$el.mousemove(k),a.extend(b.prototype,{destroy:function(){this.projection.destroy(),this.viewfinder.destroy(),this.surface.destroy()}})},c=function(b){"use strict";var d=this,e={},f={className:"ip-surface"};e=a.extend(f,b),this.image=new Image,this.image.src=e.$image.attr("src"),this.width=this.image.width,this.height=this.image.height,this.$el=a("<div/>",{"class":e.className,width:d.width,height:d.height}),a.extend(c.prototype,{getOffset:function(){return this.$el.offset()},destroy:function(){this.$el.remove(),this.$el=null}})},d=function(b){"use strict";var c=this,e={},f={className:"ip-projection",imageUrl:"",width:0,height:0,position:{left:0,top:0}};e=a.extend(f,b),this.$el=a("<div/>",{"class":e.className}),this.$el.css({left:e.position.left,top:e.position.top}),this.image=new Image,this.image.src=e.imageUrl,this.width=e.width,this.height=e.height,this.image.onload=function(){c.$el.css({"background-image":"url('"+c.image.src+"')","background-repeat":"no-repeat"}),c.$el.trigger("ip.projection.imageLoaded")},a.extend(d.prototype,{setImagePosition:function(a){this.$el.css({"background-position":a.left+"px "+a.top+"px"})},show:function(){this.$el.addClass(e.className+"--shown"),this.$el.css({width:e.width,height:e.height})},hide:function(){this.$el.removeClass(e.className+"--shown"),this.$el.css({width:0,height:0})},destroy:function(){this.$el.remove(),this.$el=null}})},e=function(b){"use strict";function c(a){var b={};return b.left=a.left-d.$el.width()/2,b.top=a.top-d.$el.height()/2,b.left=Math.max(b.left,0),b.top=Math.max(b.top,0),b.left=Math.min(b.left,f.boundaries.width-d.$el.outerWidth()),b.top=Math.min(b.top,f.boundaries.height-d.$el.outerHeight()),b}var d=this,f={},g={className:"ip-viewfinder",width:1,height:1,boundaries:{width:100,height:100}};f=a.extend(g,b),this.$el=a("<div/>",{"class":f.className}),this.$el.width(f.width),this.$el.height(f.height),this.position={},a.extend(e.prototype,{setPosition:function(a){this.position=c(a),this.$el.css({left:this.position.left+"px",top:this.position.top+"px"})},setSize:function(a){this.$el.width(a.width),this.$el.height(a.height)},show:function(){this.$el.addClass(f.className+"--shown")},hide:function(){this.$el.removeClass(f.className+"--shown")},destroy:function(){this.$el.remove(),this.$el=null}})},f={init:function(c){"use strict";return this.each(function(c,d){var e=new b(a(d),{className:"ip-container"});a(d).data("imageProjection",e)})},destroy:function(){"use strict";return this.each(function(b,c){var d=a(c).data("imageProjection");d&&d.destroy()})}};a.fn.imageProjection=function(b,c){"use strict";return f[b]?f[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist on this plugin"):f.init.apply(this,arguments)}}(window.jQuery);